<script>
	/* simple-live Web Component
	 * https://unrelenting.technology */
	(function () {
		'use strict'

		if (!window.EventSource)
			return

		window.SimpleLiveElement = document.registerElement('simple-live', {
			prototype: Object.create(HTMLElement.prototype, {
				attachedCallback: {
					value: function () {
						setTimeout(function () {
							this.es = new EventSource(this.getAttribute('src'))
							this.es.addEventListener('change', function (e) {
								var loc = window.location.toString()
								var ind = loc.indexOf("#")
								if (ind > -1) {
									loc = loc.substring(0, ind)
								}
								loc = loc.replace('ruunvald.lan:3000', 'unrelenting.technology').replace('http', 'https')
								if (e.isTrusted && e.data.split(',').indexOf(loc) > -1) {
									this.es.close()
									this.removeAttribute('hidden')
								}
							}.bind(this))
						}.bind(this), 700)
					}
				}
			})
		})
	})()
</script>
